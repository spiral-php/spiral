build:
  image: default-bionic
  environment:
    php: 8.1.2
  dependencies:
    before:
      - >
        export COMPOSER_ROOT_VERSION=$(grep '"dev-master": ' composer.json | grep -P -o '[0-9]+.[0-9]+').x-dev
  project_setup:
    override:
      - 'composer validate'
      - 'composer update --prefer-dist --no-interaction --no-progress'
  tests:
    override:
      -
        command: vendor/bin/phpunit --coverage-clover=clover.xml
        coverage:
          file: clover.xml
          format: php-clover
      - php-scrutinizer-run
