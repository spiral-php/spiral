build:
  nodes:
    analyzis:
      image: default-bionic
      environment:
        php: 8.1.2
      dependencies:
        before:
          - >
            export COMPOSER_ROOT_VERSION=$(grep '"dev-master": ' composer.json | grep -P -o '[0-9]+.[0-9]+').x-dev
          - composer validate
        override:
          - composer install --no-interaction
      project_setup:
        override:
          - 'true'
      tests:
        override:
          -
            command: 'vendor/bin/phpunit --coverage-clover=clover.xml'
            coverage:
              file: 'clover.xml'
              format: 'php-clover'
          -
            command: 'php-scrutinizer-run'
filter:
  excluded_paths:
    - 'tests/*'
    - 'src/*/tests'
